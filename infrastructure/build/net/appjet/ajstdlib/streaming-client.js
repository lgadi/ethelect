var host=window.location.host;function WebSocket(S){var B=this;var M=this;var o=2;var L={};this.onopen=function(){};
this.onclosed=function(){};this.onmessage=function(){};this.onhiccup=function(){};this.onlogmessage=function(){};
this.CONNECTING=0;this.OPEN=1;this.CLOSED=2;this.readyState=-1;var c=0;var z=setInterval(function(){c=0;
if(B.readyState==B.CLOSED){clearInterval(z);}},60*1000);var K=false;function D(AJ){if(AJ!=E&&AJ!=B){return;
}if(K){return;}A("hiccup: "+AJ.name);if(c++>10){C({reconnect:true,reason:"Too many hiccups!"});return;
}g();H(L,"hiccup",15000,function(){K=false;C({reconnect:false,reason:"Couldn't contact server to hiccup."});
});K=true;function AK(){if(!K){return;}B.onhiccup({connected:false});A("trying hiccup");H(L,"singleHiccup",5000,function(){AK();
});T("post",b(),true,[{key:"oob",value:"hiccup"}],function(AM,AL){if(!K){return;}if(AL.substring(0,"restart-fail".length)=="restart-fail"){C({reconnect:true,reason:"Server restarted or socket timed out on server."});
}else{if(AM!=200||AL.substring(0,2)!="ok"){A("Failed to hiccup with error: "+AM+" / "+AL);setTimeout(AK,500);
}else{K=false;L.singleHiccup();L.hiccup();k();}}});}AK();}function g(){for(var AJ in I){if(I.hasOwnProperty(AJ)){I[AJ].disconnect();
}}E=undefined;}function C(AJ,AK,AL){A("disconnected: "+AJ.reason+" / "+(AJ.data!==undefined?"data: "+AJ.data:""));
AF();g();if(J&&J.div){J.div.innerHTML="";}if(B.readyState!=B.CLOSED){B.readyState=B.CLOSED;if(!AK){Z(true,"kill:"+AJ.reason,AL,true);
}B.onclosed(AJ);}}this.disconnect=function(AJ){C({reason:"Closed by client."},false,AJ);};function u(){var AJ=AI();
A("basic connect on type: "+AJ);var AK=I[AJ]=new p[AJ]();AK.connect();}function AG(){var AL=AD();var AM;
var AJ;for(var AK=0;AK<AL.length;++AK){AJ=AL[AK];A("other connect on type: "+AJ);AM=I[AJ]=new p[AJ]();
AM.connect();}}function k(){A("doing connect!");H(L,"connect",15000,function(){C({reconnect:false,reason:"Timeout connecting to server: no channel type was able to connect."});
});u();}this.connect=function(){A("socket connecting: "+S);k();};function Y(){return Math.floor((new Date()).valueOf()/100)%10000000;
}function A(AJ){B.onlogmessage("(comet @t: "+Y()+") "+AJ);}function AF(){A(B.describe());}this.describe=function(){function AJ(){out=[];
for(var AK in I){if(I.hasOwnProperty(AK)){out.push(AK+": "+I[AK].describe());}}return"[ "+out.join(", ")+" ]";
}return("socket state: { id: "+S+", readyState: "+B.readyState+", isHiccuping: "+K+", timeouts: "+O(L)+", officialChannel: "+(E?E.name:"none")+", channels: "+AJ()+", isPosting: "+P+", lastReceivedSeqNumber: "+F+", lastPost: "+i+", postTimeouts: "+O(W)+", channelSeq: "+f+" }");
};function AA(AJ,AK){return function(){var AM=[];for(var AL=0;AL<arguments.length;AL++){AM.push(arguments[AL]);
}AK.apply(AJ,AM);};}var G=AA;function T(AS,AT,AN,AL,AO,AU){var AJ=(AU||d)();AJ.open(AS,AT,AN);if(AN){AJ.onreadystatechange=function(){if(AJ.readyState!=4){return;
}var AV;var AW;try{AV=AJ.status;AW=AJ.responseText;}catch(AX){}AO(AV,AW,AJ);};}var AK=null;if(AL){AK=[];
for(var AM=0;AM<AL.length;++AM){AK.push(encodeURIComponent(AL[AM].key)+"="+encodeURIComponent(AL[AM].value));
}AK=AK.join("&");AJ.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8");
}try{AJ.send(AK);}catch(AQ){AJ.abort();AO(500,"Error sending data!",AJ);}if(!AN){var AP;var AR;try{AP=AJ.status;
AR=AJ.responseText;}catch(AQ){}AO(AP,AR,AJ);}return AJ;}var m=function(){};function H(AK,AJ,AO,AN){function AM(AR,AQ){if(AR[AQ]){AR[AQ]();
AR[AQ]=m;}}var AP=setTimeout(function(){AM(AK,AJ);AN();},AO);var AL=function(){clearTimeout(AP);};AM(AK,AJ);
AK[AJ]=AL;return AL;}var F=0;function x(AJ){if(AJ.seqNumber>F+1){A("bad sequence number. expecting: "+(F+1)+", got: "+AJ.seqNumber);
D(B);return false;}if(AJ.seqNumber<F+1){return true;}F=AJ.seqNumber;if(!AJ.isControl){B.onmessage({data:AJ.content});
return true;}else{if(AJ.content=="kill"){C({reconnect:false,reason:"Killed by server."});return false;
}}}var b=function(){return"%contextPath%/post?r="+R()+"&v="+o+"&id="+S+"&seq="+F;};function AB(){var AJ=[];
var AK=0;var AL=0;this.offer=function(AM){AJ[AL++]=AM;};this.poll=function(){if(this.length()>0){var AM=AJ[AK];
delete AJ[AK++];return AM;}};this.clear=function(){AK=0;AL=0;var AM=AJ;AJ=[];return AM;};this.length=function(){return AL-AK;
};}var n=new AB();var P=false;var W={};var i;function Z(AK,AN,AL,AM,AJ){h([{oob:AK,data:AN,cb:AJ}],AL,AM);
}function h(AJ,AQ,AO,AM){if(!AO&&B.readyState==B.CLOSED){return;}if(AJ.length==0){if(AM){AM();}return;
}var AN=[];var AL=[];for(var AK=0;AK<AJ.length;++AK){AN.push({key:(AJ[AK].oob?"oob":"m"),value:AJ[AK].data});
if(AJ[AK].cb){AL.push(AJ[AK].cb);}}function AR(AY,AX,AU,AW){var AT="";try{AT=AY+": "+AU.statusText+" - "+AX+" ("+AW+")";
}catch(AV){}C({reconnect:true,reason:"Posting message failed.",data:AT});for(var AS=0;AS<AL.length;++AS){AL[AS](false,AT);
}}function AP(AU,AT,AV){W.post();if(AU!=200||AT.substring(0,2)!="ok"){AR(AU,AT,AV,"1");}else{for(var AS=0;
AS<AL.length;++AS){AL[AS](true);}if(AM){AM();}}}H(W,"post",15000,function(){C({reconnect:true,reason:"Posting message timed out."});
});T("post",b(),!AQ,AN,AP);}function e(){if(P==true){return;}var AJ=n.clear();if(AJ.length==0){return;
}P=true;h(AJ,false,false,function(){P=false;setTimeout(e,0);});i=Y();}this.postMessage=function(AK,AJ){if(B.readyState!=B.OPEN){return;
}n.offer({data:AK,cb:AJ});setTimeout(function(){e();},0);};function q(){var AL=[];for(var AK=0;AK<X.length;
++AK){var AJ=X[AK];if(window.location.hash.length>0){if(window.location.hash!="#"+AJ){continue;}}if($&&$.browser.opera&&AJ!="shortpolling"&&AJ!="streaming"){continue;
}AL.push(AJ);}return AL;}function AI(){return q()[0];}function AD(){return q().slice(1);}var E;this.getTransportType=function(){return(E?E.name:"none");
};var X="%acceptableChannelTypes%";var w="%canUseSubdomains%";var I={};var p={shortpolling:a,longpolling:v,streaming:AH};
function O(AJ){var AL=[];for(var AK in AJ){if(AJ.hasOwnProperty(AK)){AL.push(AK+": "+(AJ[AK]==m?"unset":"set"));
}}return"{ "+AL.join(", ")+" }";}var f=1;function j(AJ){L.connect();if(!E||AJ.weight>E.weight){A("switching to use channel: "+AJ.name);
var AK=E;E=AJ;setTimeout(function(){Z(true,"useChannel:"+(f++)+":"+AJ.name,false,false,function(AM,AL){if(AM){if(AK){AK.disconnect();
}else{AG();}if(B.readyState!=B.OPEN){B.readyState=B.OPEN;B.onopen({});}else{B.onhiccup({connected:true});
}}else{C({reconnect:true,reason:"Failed to select channel on server.",data:AL});}});},0);return true;
}else{return false;}}function R(){return String(Math.round(Math.random()*1000000000000));}function Q(){return"%contextPath%/channel?v="+o+"&r="+R()+"&id="+S;
}function d(){var AJ=false;try{AJ=(window.ActiveXObject&&new ActiveXObject("Msxml2.XMLHTTP"));}catch(AK){try{AJ=(window.ActiveXObject&&new ActiveXObject("Microsoft.XMLHTTP"));
}catch(AL){AJ=false;}}if(!AJ&&typeof XMLHttpRequest!="undefined"){try{AJ=new XMLHttpRequest();}catch(AK){AJ=false;
}}if(!AJ&&window.createRequest){try{AJ=window.createRequest();}catch(AK){AJ=false;}}return AJ;}function N(AJ){this.message=AJ;
}function U(AK,AL){if(!AL){AL=0;}var AJ=AK.indexOf(":",AL);if(AJ<0){return;}var AM=Number(AK.substring(AL,AJ));
if(isNaN(AM)){throw new N("Bad length: "+AK.substring(AL,AJ));}if(AK.length<AJ+1+AM){return;}var AN=AK.substr(AJ+1,AM);
return{message:AN,lastConsumedChar:AJ+1+AM};}function AE(AJ,AK){if(AK==0){return{message:AJ,lastConsumedChar:AJ.length};
}}function s(AS,AN,AT){if(!AN){AN=0;}var AM=[];var AL=AN;while(true){var AK=(AT||U)(AS,AL);if(!AK){break;
}AL=AK.lastConsumedChar;var AQ=AK.message;var AJ=AQ.split(":");if(AJ[0]=="oob"){AM.push({oob:AJ.slice(1).join(":")});
continue;}var AP=Number(AJ[0]);if(isNaN(AP)){throw new N("Bad sequence number: "+AJ[0]);}var AO=Number(AJ[1]);
if(isNaN(AO)){throw new N("Bad control: "+AJ[1]);}var AR=AJ.slice(2).join(":");AM.push({seqNumber:AP,isControl:(AO==1),content:AR});
}return{messages:AM,lastConsumedChar:AL};}function V(AO,AP,AN,AM){try{messages=s(AO,AP,AM);}catch(AJ){if(AJ instanceof N){A("Data format error: "+AJ.message);
D(AN);return;}else{A(AJ.toString()+" on line: "+AJ.lineNumber);}}for(var AK=0;AK<messages.messages.length;
AK++){var AL=messages.messages[AK].oob;if(AL){if(AL=="restart-fail"){C({reconnect:true,reason:"Server restarted or socket timed out on server."});
return;}}else{if(!x(messages.messages[AK])){break;}}}return messages.lastConsumedChar;}function a(){this.weight=0;
this.name="shortpolling";this.isConnected=false;this.isClosed=false;this.request;this.clearRequest=function(){if(this.request){this.request.abort();
this.request=null;}};this.timeouts={};this.describe=function(){return"{ isConnected: "+this.isConnected+", isClosed: "+this.isClosed+", timeouts: "+O(this.timeouts)+", request: "+(this.request?"set":"not set")+" }";
};this.pollDataHandler=function(AK,AJ,AL){if(AL.readyState!=4){return;}if(this.timeouts.poll){this.timeouts.poll();
}var AO;if(!this.isConnected){this.timeouts.connectAttempt();if(AK!=200){A(this.name+" connect failed: "+AK+" / "+AJ);
setTimeout(G(this,this.attemptConnect),500);return;}var AM=(AJ?U(AJ):undefined);if(AM&&AM.message=="oob:ok"){this.timeouts.initialConnect();
this.isConnected=true;A(this.name+" transport connected!");if(!j(this)){A(this.name+" transport not chosen for activation.");
this.disconnect();return;}this.doPoll();return;}else{A(this.name+" connect didn't get ok: "+AK+" / "+AJ);
setTimeout(G(this,this.attemptConnect),500);return;}}var AN=V(AL.responseText,0,this);if(AK!=200||((!AN)&&this.emptyResponseBad)){D(this);
}setTimeout(G(this,this.doPoll),this.pollDelay);this.clearRequest();};this.keepRetryingConnection=true;
this.cancelConnect=function(){this.clearRequest();this.keepRetryingConnection=false;};this.cancelPoll=function(){this.clearRequest();
A("poll timed out.");D(this);};this.doPoll=function(){if(this.isClosed){return;}H(this.timeouts,"poll",this.pollTimeout,G(this,this.cancelPoll));
this.request=T("GET",Q()+"&channel="+this.name+"&seq="+F+this.pollParams(),true,undefined,G(this,this.pollDataHandler),this.xhrGenerator);
};this.pollParams=function(){return"";};this.pollTimeout=5000;this.pollDelay=500;this.attemptConnect=function(){if(!this.keepRetryingConnection){return;
}A(this.name+" attempting connect");this.clearRequest();H(this.timeouts,"connectAttempt",5000,G(this,this.attemptConnect));
this.request=T("GET",Q()+"&channel="+this.name+"&new=yes&create="+(M.readyState==M.OPEN?"no":"yes")+"&seq="+F,true,undefined,G(this,this.pollDataHandler),this.xhrGenerator);
};this.connect=function(){this.attemptConnect();H(this.timeouts,"initialConnect",15000,G(this,this.cancelConnect));
};this.disconnect=function(){A(this.name+" disconnected");this.isClosed=true;this.clearRequest();};}function AH(){this.weight=2;
this.name="streaming";var AM=this;var AP=false;var AK;function AT(){if(AK){AK.abort();AK=null;if(AJ){AJ=null;
}if(AL){AL.innerHTML="";AL=null;}}}var AO=false;var AN={};var AQ=0;this.describe=function(){return"{ isConnected: "+AP+", isClosed: "+AO+", timeouts: "+O(AN)+", request: "+(AK?"set":"not set")+", cursor: "+AQ+" }";
};function AV(){AP=true;AN.initialConnect();if(!j(AM)){A("streaming transport not chosen for activation");
AM.disconnect();return;}}function AW(){if(AN.data){AN.data();}if(AO){return;}try{if(!AK.responseText){return;
}}catch(AZ){return;}if(!AP){var AY=U(AK.responseText,AQ);if(!AY){return;}AQ=AY.lastReceivedSeqNumber;
if(AY.message=="oob:ok"){AV();}else{A("stream: incorrect channel connect message:"+AY.message);AM.disconnect();
return;}}else{AQ=V(AK.responseText,AQ,AM);}if(!AK||AK.readyState==4){AT();if(AP){A("stream connection unexpectedly closed.");
D(AM);return;}}H(AN,"data",60*1000,function(){D(AM);});}function AU(AY){if(AO){return;}if(!AP){if(AY=="oob:ok"){AV();
}else{A("iframe stream: unexpected data on connect - "+AY);}}else{V(AY,0,AM,AE);}}function AX(){AO=true;
AT();A("stream: failed to connect.");}var AJ;var AL;var AR=0;function AS(){var AY;try{AY=AL.firstChild.readyState;
}catch(AZ){D(AM);return;}if(AY=="interactive"||AR>10){try{var Aa=AL.firstChild.contentWindow.document.getElementById("thebody");
}catch(AZ){D(AM);}}else{AR++;setTimeout(AS,500);}}this.connect=function(){H(AN,"initialConnect",15000,AX);
if(w){var AY="//"+R()+".comet."+host+Q()+"&channel=streaming&type=iframe&new=yes&create="+(M.readyState==M.OPEN?"no":"yes")+"&seq="+F;
A("stream to: "+AY);if($&&$.browser.opera){AL=$('<div style="display: none;"></div>').get(0);$("body").append(AL);
window.comet={pass_data:AU,disconnect:function(){D(AM);}};$(AL).append($("<iframe src='"+AY+"'></iframe>"));
AR=0;setTimeout(AS,2000);A("stream connect sent!");return;}try{AJ=(window.ActiveXObject&&new ActiveXObject("htmlfile"));
if(AJ){AJ.open();AJ.write("<html><head><title>f</title></head><body>");AJ.write("<s"+"cript>document.domain='"+document.domain+"';</s"+"cript>");
AJ.write("</body></html>");AJ.close();AL=AJ.createElement("div");AJ.appendChild(AL);AJ.parentWindow.comet={pass_data:AU,disconnect:function(){D(AM);
}};AL.innerHTML="<iframe src='"+AY+"'></iframe>";AR=0;setTimeout(AS,2000);}}catch(AZ){AJ=false;}}else{if($&&$.browser.opera){A("opera - not trying xhr");
return;}}if(!AJ){AK=d();AK.open("get",Q()+"&channel=streaming&new=yes&create="+(M.readyState==M.OPEN?"no":"yes")+"&seq="+F);
AK.onreadystatechange=AW;try{AK.send(null);}catch(AZ){}}A("stream connect sent!");};this.disconnect=function(){A("stream disconnected");
AO=true;AT();};A("new streamchannel");}function l(AJ){return"//"+AJ+".comet."+host+"%contextPath%/xhrXdFrame";
}function t(){if(!document.getElementById("newcomethidden")){var AJ=document.createElement("div");AJ.setAttribute("id","newcomethidden");
AJ.style.display="none";document.body.appendChild(AJ);}return document.getElementById("newcomethidden");
}function AC(AJ){this.open=function(AN,AM,AL){this.method=AN;this.uri=AM;this.async=AL;};var AK={};this.setRequestHeader=function(AL,AM){AK[AL]=AM;
};this.send=function(AM){var AL=this;this.xhr=AJ.iframe.contentWindow.doAction(this.method,this.uri,this.async,AK,AM||null,function(AN,AO){AL.readyState=4;
AL.status=AN;AL.responseText=AO;AL.onreadystatechange();});};this.abort=function(){if(this.xhr){AJ.contentWindow.doAbort(this.xhr);
}};}function r(AN){var AL=R();try{var AJ=(window.ActiveXObject&&new ActiveXObject("htmlfile"));var AK;
if(AJ){AJ.open();AJ.write("<html><head><title>f</title></head><body>");AJ.write("<scr"+"ipt>document.domain='"+document.domain+"';</scr"+"ipt>");
AJ.write("</body></html>");AJ.close();AK=AJ.createElement("div");AJ.appendChild(AK);AJ.parentWindow["done_"+AL]=AN;
AK.innerHTML="<iframe src='"+l(AL)+"'></iframe>";return{iframe:AK.firstChild,axc:AJ,div:AK};}}catch(AO){AJ=false;
}A("Not using IE setup.");var AM=document.createElement("iframe");t().appendChild(AM);window["done_"+AL]=function(){try{delete window["done_"+AL];
}catch(AP){}AN();};AM.src=l(AL);return{iframe:AM};}function y(){if(!J){throw Error("WebSocket isn't properly set up!");
}return new AC(J);}var J;function v(){a.apply(this);this.weight=1;this.name="longpolling";this.pollDelay=0;
this.pollTimeout=15000;this.pollParams=function(){return"&timeout="+(this.pollTimeout-5000);};var AJ=this.connect;
this.connect=function(){if(!J){J=r(G(this,AJ));}else{AJ.apply(this);}};this.xhrGenerator=y;this.emptyResponseBad=true;
}}